<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–£–ª—ã–±–Ω–∏ –°–±–µ—Ä ‚Ä¢ –ö–≤–µ—Å—Ç</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --sber: #00a650;
      --sber-dark: #00843d;
      --gold: #ffd700;
      --gold-gradient: linear-gradient(135deg, #ffb800, #ffd700, #ffea80);
      --light: #e6f4ea;
      --bg-gradient: linear-gradient(135deg, #f0f9f3 0%, #d4efe0 50%, #b8e6cd 100%);
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-gradient);
      color: #1e1e1e;
      min-height: 100dvh;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom);
      overflow-x: hidden;
    }

    .container { max-width: 500px; margin: 0 auto; padding: 0 16px; padding-bottom: 90px; }

    h1 {
      text-align: center;
      font-size: 30px;
      color: var(--sber-dark);
      margin: 20px 0 6px;
      font-weight: 900;
    }
    .subtitle {
      text-align: center;
      color: #555;
      font-size: 15px;
      margin-bottom: 24px;
    }

    /* –ü—Ä–æ—Ñ–∏–ª—å –≤ —à–∞–ø–∫–µ */
    .profile {
      background: white;
      border-radius: 24px;
      padding: 20px;
      margin: 0 0 24px;
      box-shadow: 0 10px 40px rgba(0,166,80,0.18);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .avatar {
      width: 72px; height: 72px;
      border-radius: 50%;
      background: var(--sber);
      color: white;
      font-size: 32px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,166,80,0.3);
    }
    .rank-info {
      flex: 1;
      margin-left: 16px;
    }
    .rank {
      font-size: 19px;
      font-weight: 800;
      color: var(--sber-dark);
    }
    .to-next {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }
    .points {
      font-size: 38px;
      font-weight: 900;
      color: var(--sber);
      text-shadow: 0 2px 10px rgba(0,166,80,0.2);
    }

    /* –ö–†–ê–°–ò–í–´–ô –ë–õ–û–ö –° –†–ê–ù–ì–ê–ú–ò –í –õ–ò–ß–ù–û–ú –ö–ê–ë–ò–ù–ï–¢–ï */
    .ranks-progress {
      background: linear-gradient(135deg, rgba(0,166,80,0.12), rgba(0,166,80,0.05));
      border: 2px solid rgba(0,166,80,0.15);
      border-radius: 24px;
      padding: 20px;
      margin: 24px 0;
      position: relative;
      overflow: hidden;
    }
    .ranks-progress::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 4px;
      background: var(--gold-gradient);
      border-radius: 2px 2px 0 0;
    }
    .ranks-title {
      font-size: 18px;
      font-weight: 900;
      color: var(--sber-dark);
      text-align: center;
      margin-bottom: 20px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .ranks-list {
      display: flex;
      align-items: flex-end;
      position: relative;
      padding: 0 8px;
      justify-content: center;
    }
    .rank-item {
      text-align: center;
      flex: 1;
      position: relative;
      z-index: 2;
    }
    .rank-item.active .rank-circle {
      background: var(--gold-gradient);
      color: #8B5A00;
      transform: scale(1.25);
      box-shadow: 0 0 30px rgba(255,215,0,0.6);
    }
    .rank-item.active .rank-label {
      font-weight: 900;
      color: var(--sber-dark);
      font-size: 15px;
    }
    .rank-circle {
      width: 54px; height: 54px;
      border-radius: 50%;
      background: rgba(255,255,255,0.9);
      border: 4px solid #ddd;
      margin: 0 auto 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      backdrop-filter: blur(4px);
    }
    .rank-label {
      font-size: 11px;
      color: #666;
      line-height: 1.3;
      transition: all 0.3s;
    }
    .rank-points {
      font-size: 12px;
      font-weight: bold;
      color: var(--sber-dark);
      margin-top: 4px;
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–ª–∏–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–Ω–≥–∞–º–∏ */
    .progress-line {
      position: absolute;
      top: 15px;
      left: 15%;
      right: 15%;
      height: 6px;
      background: #ddd;
      border-radius: 3px;
      overflow: hidden;
      z-index: 1;
    }
    .progress-fill {
      height: 100%;
      background: var(--gold-gradient);
      width: 0%;
      border-radius: 3px;
      transition: width 0.8s ease;
    }

    .card { background: white; border-radius: 24px; padding: 20px; margin: 16px 0; box-shadow: 0 8px 30px rgba(0,0,0,0.1); display: none; }
    .card.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(15px)} to {opacity:1; transform:none} }

    .mission {
      background: #f8fff9;
      border: 2px solid #d4f0dd;
      border-radius: 20px;
      padding: 18px;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s;
    }
    .mission:active { transform: scale(0.98); }
    .mission.legendary {
      background: var(--gold-gradient);
      color: white;
      border: none;
      box-shadow: 0 10px 30px rgba(255,183,0,0.4);
    }
    .mission button {
      background: var(--sber);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 14px;
      font-weight: bold;
      float: right;
      margin-top: 12px;
      font-size: 15px;
    }
    .mission.legendary button {
      background: white;
      color: #b8860b;
    }

    .nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: white;
      display: flex;
      padding: 12px 20px env(safe-area-inset-bottom);
      box-shadow: 0 -8px 30px rgba(0,0,0,0.12);
      border-radius: 24px 24px 0 0;
      backdrop-filter: blur(10px);
      z-index: 100;
    }
    .nav-btn {
      flex: 1;
      padding: 14px;
      text-align: center;
      font-size: 26px;
      border-radius: 18px;
      transition: all 0.3s;
    }
    .nav-btn.active {
      background: var(--sber);
      color: white;
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0,166,80,0.3);
    }

    .success {
      text-align: center;
      padding: 50px 20px;
      background: white;
      border-radius: 24px;
      margin: 30px 16px;
      border: 4px solid var(--sber);
      box-shadow: 0 15px 40px rgba(0,166,80,0.2);
      display: none;
    }
    .confetti { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; }
        .overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(0,0,0,0.75); backdrop-filter: blur(10px);
      z-index: 1000; display: none; align-items: center; justify-content: center; 
      padding: 20px; transition: opacity 0.3s;
    }
    .modal {
      background: white; border-radius: 24px; width: 100%; max-width: 420px; 
      padding: 24px; max-height: 95vh; overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .close-btn { 
      float: right; font-size: 32px; cursor: pointer; color: #aaa; 
      line-height: 1; margin-top: -8px;
    }
    .close-btn:hover { color: #000; }
    .btn {
      background: var(--sber); color: white; border: none; padding: 16px; border-radius: 16px; font-size: 17px; font-weight: 700; width: 100%; margin: 12px 0; cursor: pointer;
    }
    .btn-dark { background: var(--sber-dark); }
  </style>
</head>
<body>
  <div class="container">

    <h1>–£–ª—ã–±–Ω–∏ –°–±–µ—Ä üòÑ</h1>
    <p class="subtitle">–û—Ö–æ—Ç—å—Å—è –∑–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º–∏ –∏ —Å—Ç–∞–Ω—å –ì–µ–Ω–µ—Ä–∞–ª–æ–º –£–ª—ã–±–∫–∏!</p>

    <div class="profile">
      <div style="display:flex; align-items:center; gap:16px;">
        <div class="avatar" id="avatar">–ê</div>
        <div class="rank-info">
          <div class="rank" id="rank">–ò–Ω–∂–µ–Ω–µ—Ä —É–ª—ã–±–∫–∏ üõ†Ô∏è</div>
          <div class="to-next">–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ ‚Äî <span id="toNext">460</span> –±–∞–ª–ª–æ–≤</div>
        </div>
      </div>
      <div class="points" id="points">340</div>
    </div>

    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="homeScreen" class="card active">

      <div class="mission legendary">
        <b>üî• –õ–ï–ì–ï–ù–î–ê–†–ù–ê–Ø –ú–ò–°–°–ò–Ø</b><br>
        –ü–µ—Ä–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –º–µ—Ç—Ä–æ!<br>
        <b style="font-size:20px;">+500 –±–∞–ª–ª–æ–≤</b>
        <button onclick="openMission('legendary', 500)">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
      </div>

      <div class="mission">
        <b>–û—Ö–æ—Ç–Ω–∏–∫ –∑–∞ —Å—Ç–µ–∫–ª–æ–º üïµÔ∏è‚Äç‚ôÇÔ∏è</b><br>
        –ù–∞–π–¥–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª –∑–∞ —Å—Ç–µ–∫–ª–æ–º<br>
        <b>+70 –±–∞–ª–ª–æ–≤</b>
        <button onclick="openMission('glass', 70)">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
      </div>

      <div class="mission">
        <b>–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —É–ª—ã–±–∫–∞ üòä</b><br>
        –°–¥–µ–ª–∞–π —Ñ–æ—Ç–æ –ª—é–±–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞<br>
        <b>+15 –±–∞–ª–ª–æ–≤</b>
        <button onclick="openMission('daily', 15)">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
      </div>
    </div>

    <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å –ö–†–£–¢–´–ú –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º —Ä–∞–Ω–≥–æ–≤ -->
    <div id="profileScreen" class="card">
      <h2 style="text-align:center; margin-bottom:20px;">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
      
      <div style="text-align:center; padding:20px 0;">
        <div class="avatar" style="width:130px; height:130px; font-size:68px; margin:0 auto 20px; box-shadow:0 8px 30px rgba(0,166,80,0.3);">–ê</div>
        <div class="rank" style="font-size:28px; margin:12px 0;" id="profileRank">–ò–Ω–∂–µ–Ω–µ—Ä —É–ª—ã–±–∫–∏ üõ†Ô∏è</div>
        <div style="font-size:42px; font-weight:900; color:var(--sber); margin:20px 0;" id="profilePoints">340</div>
      </div>

      <!-- üî• –ö–†–ê–°–ò–í–´–ô –ü–†–û–ì–†–ï–°–° –†–ê–ù–ì–û–í üî• -->
      <div class="ranks-progress">
        <div class="ranks-title">üìà –ü—É—Ç—å –∫ –∑–≤–∞–Ω–∏—é –ì–µ–Ω–µ—Ä–∞–ª–∞ –£–ª—ã–±–∫–∏</div>
        
        <div class="progress-line"><div class="progress-fill" id="progressFill"></div></div>
        
        <div class="ranks-list">
          <div class="rank-item">
            <div class="rank-circle">üë∂</div>
            <div class="rank-label">–ù–æ–≤–∏—á–æ–∫</div>
          </div>
          <div class="rank-item">
            <div class="rank-circle">üòÑ</div>
            <div class="rank-label">–†–∞–∑–≤–µ–¥—á–∏–∫<br>—É–ª—ã–±–∫–∏</div>
            <div class="rank-points">100</div>
          </div>
          <div class="rank-item active">
            <div class="rank-circle">üõ†Ô∏è</div>
            <div class="rank-label">–ò–Ω–∂–µ–Ω–µ—Ä<br>—É–ª—ã–±–∫–∏</div>
            <div class="rank-points">300</div>
          </div>
          <div class="rank-item">
            <div class="rank-circle">üö¢</div>
            <div class="rank-label">–ö–∞–ø–∏—Ç–∞–Ω<br>—ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞</div>
            <div class="rank-points">800</div>
          </div>
          <div class="rank-item">
            <div class="rank-circle">‚≠ê</div>
            <div class="rank-label">–ì–µ–Ω–µ—Ä–∞–ª<br>–£–ª—ã–±–∫–∏</div>
            <div class="rank-points">2000</div>
          </div>
        </div>
      </div>

      <button class="btn" style="background:var(--sber); color:white; padding:16px; border-radius:16px; font-size:17px; font-weight:700; width:100%; margin-top:20px; border-color: white;"
              onclick="tg.showPopup({title:'–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞', message:'–ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π –∏ –ø–æ–ª—É—á–∏ +100 –±–∞–ª–ª–æ–≤ –∑–∞ –¥—Ä—É–≥–∞!', buttons:[{text:'–ü–æ–¥–µ–ª–∏—Ç—å—Å—è', type:'default'}]})">
        üéâ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞ (+100 –±–∞–ª–ª–æ–≤)
      </button>
    </div>

    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ (–æ—Å—Ç–∞–≤–∏–ª –∫–∞–∫ –±—ã–ª–æ, –Ω–æ –º–æ–∂–Ω–æ —Ç–æ–∂–µ —É–ª—É—á—à–∏—Ç—å) -->
    <div id="leaderboardScreen" class="card">
      <h2 style="text-align:center;">üèÜ –¢–æ–ø –†–æ—Å—Å–∏–∏</h2>
      <div style="background:#fff4e0; padding:20px; border-radius:20px; text-align:center; line-height:2; font-size:16px;">
        ü•á @max_smile ‚Äî 1240<br>
        ü•à @anna_quest ‚Äî 1180<br>
        ü•â @dmitry_sber ‚Äî 980<br>
        4. @katya_pay ‚Äî 850<br>
        <b style="color:var(--sber); font-size:18px;">5. –¢—ã ‚Äî <span id="leaderPoints">340</span> –±–∞–ª–ª–æ–≤ üî•</b>
      </div>
    </div>

    <div id="successScreen" class="success">
      <h2 style="font-size:28px; margin-bottom:16px;">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</h2>
      <p style="font-size:22px; color:var(--sber);">+<span id="addedPoints">15</span> –±–∞–ª–ª–æ–≤ –Ω–∞—á–∏—Å–ª–µ–Ω–æ!</p>
      <p style="margin-top:16px; color:#555;">–¢—ã –¥–µ–ª–∞–µ—à—å –æ–ø–ª–∞—Ç—É —É–ª—ã–±–∫–æ–π –ª—É—á—à–µ –¥–ª—è –≤—Å–µ—Ö üòÑ</p>
    </div>
  </div>

    <!-- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ–≤–µ—Ä–ª–µ–π —Å —Ñ–æ—Ä–º–æ–π -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <span class="close-btn" onclick="closeOverlay()">√ó</span>
      <h2 id="missionTitle" style="text-align:center; margin-bottom:20px;">–ú–∏—Å—Å–∏—è</h2>
      
      <form id="missionForm">
        <select required style="width:100%; padding:14px; margin:10px 0; border:2px solid #ddd; border-radius:14px; font-size:16px;">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã</option>
          <option>–¢–µ—Ä–º–∏–Ω–∞–ª –∑–∞ —Å—Ç–µ–∫–ª–æ–º</option>
          <option>–¢–µ—Ä–º–∏–Ω–∞–ª —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ</option>
          <option>–ù–µ—Ç –æ–ø–ª–∞—Ç—ã —É–ª—ã–±–∫–æ–π</option>
          <option>–î—Ä—É–≥–æ–µ</option>
        </select>
        
        <input type="text" placeholder="–ú–∞–≥–∞–∑–∏–Ω / –∞–¥—Ä–µ—Å" required style="width:100%; padding:14px; margin:10px 0; border:2px solid #ddd; border-radius:14px; font-size:16px;">
        <input type="text" placeholder="–ì–æ—Ä–æ–¥" required style="width:100%; padding:14px; margin:10px 0; border:2px solid #ddd; border-radius:14px; font-size:16px;">
        
        <textarea placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="width:100%; padding:14px; margin:10px 0; border:2px solid #ddd; border-radius:14px; font-size:16px; height:90px; resize:none;"></textarea>
        
        <button type="button" class="btn" id="takePhoto" style="background:var(--sber-dark); margin:16px 0;">
          üì∏ –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
        </button>
        
        <div id="photoPreview" style="display:none; margin:16px 0; border-radius:16px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.1);">
          <img id="previewImg" style="width:100%; display:block;">
          <div style="padding:10px; text-align:center; background:#f0f0f0; color:#666; font-size:14px;">
            –§–æ—Ç–æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ ‚úì –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–ª–æ–≤
          </div>
        </div>
        
        <button type="submit" class="btn" style="background:var(--sber); margin-top:10px;">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–ª—ã ‚úÖ
        </button>
      </form>
    </div>
  </div>

  <div class="nav">
    <div class="nav-btn active" onclick="show('homeScreen')">üè†</div>
    <div class="nav-btn" onclick="show('leaderboardScreen')">üèÜ</div>
    <div class="nav-btn" onclick="show('profileScreen')">üë§</div>
  </div>

  <canvas id="confetti" class="confetti"></canvas>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand(); tg.ready();

    let points = 340;
    let currentBonus = 0; 
    const ranks = [
      { name: "–ù–æ–≤–∏—á–æ–∫", emoji: "üë∂", threshold: 0 },
      { name: "–†–∞–∑–≤–µ–¥—á–∏–∫ —É–ª—ã–±–∫–∏", emoji: "üòÑ", threshold: 100 },
      { name: "–ò–Ω–∂–µ–Ω–µ—Ä —É–ª—ã–±–∫–∏ üõ†Ô∏è", emoji: "üõ†Ô∏è", threshold: 300 },
      { name: "–ö–∞–ø–∏—Ç–∞–Ω —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞", emoji: "üö¢", threshold: 800 },
      { name: "–ì–µ–Ω–µ—Ä–∞–ª –£–ª—ã–±–∫–∏ ‚≠ê", emoji: "‚≠ê", threshold: 2000 }
    ];

    function updateRankProgress() {
      let currentRankIndex = 0;
      let nextThreshold = ranks[1].threshold;

      for (let i = 0; i < ranks.length; i++) {
        if (points >= ranks[i].threshold) {
          currentRankIndex = i;
        }
      }

      const currentRank = ranks[currentRankIndex];
      const nextRank = ranks[currentRankIndex + 1] || ranks[ranks.length - 1];

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—ã
      document.getElementById('rank').textContent = currentRank.name;
      document.getElementById('profileRank').textContent = currentRank.name;
      document.getElementById('toNext').textContent = nextRank.threshold - points;

      // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–Ω–≥
      document.querySelectorAll('.rank-item').forEach((el, i) => {
        el.classList.toggle('active', i === currentRankIndex);
      });

      // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
      const progressPercent = currentRankIndex === ranks.length - 1 
        ? 100 
        : (points - currentRank.threshold) / (nextRank.threshold - currentRank.threshold) * 100;
      
      const fillWidth = (currentRankIndex / (ranks.length - 1)) * 100 + (progressPercent / (ranks.length - 1));
      document.getElementById('progressFill').style.width = fillWidth + '%';
    }

    function updateAll() {
      document.getElementById('points').textContent = points;
      document.getElementById('profilePoints').textContent = points;
      document.getElementById('leaderPoints').textContent = points;
      document.getElementById('avatar').textContent = (tg.initDataUnsafe.user?.first_name || '–ê')[0].toUpperCase();
      updateRankProgress();
    }


    function show(screen) {
      document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
      document.getElementById(screen).classList.add('active');
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      
      // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
      if (screen === 'homeScreen') {
        document.querySelectorAll('.nav-btn')[0].classList.add('active'); // üè†
      } else if (screen === 'leaderboardScreen') {
        document.querySelectorAll('.nav-btn')[1].classList.add('active');
      } else if (screen === 'profileScreen') {
        document.querySelectorAll('.nav-btn')[2].classList.add('active');
      }
      
      document.getElementById('successScreen').style.display = 'none';
      closeOverlay();
    }

    function openMission(type, bonus) {
      currentBonus = bonus;
      const titles = { legendary: 'üî• –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –º–∏—Å—Å–∏—è', glass: '–û—Ö–æ—Ç–Ω–∏–∫ –∑–∞ —Å—Ç–µ–∫–ª–æ–º', daily: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —É–ª—ã–±–∫–∞' };
      document.getElementById('missionTitle').textContent = titles[type];
      document.getElementById('overlay').style.display = 'flex';
    }

    function closeOverlay() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('photoPreview').style.display = 'none';
    }

    // –§–æ—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    document.getElementById('takePhoto').onclick = () => {
      const input = document.createElement('input');
      input.type = 'file'; input.accept = 'image/*'; input.capture = 'environment';
      input.onchange = e => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = ev => {
            document.getElementById('previewImg').src = ev.target.result;
            document.getElementById('photoPreview').style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    };

    document.getElementById('missionForm').onsubmit = e => {
      e.preventDefault();
      points += currentBonus;
      document.getElementById('addedPoints').textContent = currentBonus;

      createConfetti();
      closeOverlay();
      document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
      document.getElementById('successScreen').style.display = 'block';

      setTimeout(() => {
        updateAll();
        show('homeScreen');
      }, 2500);
    };

    function createConfetti() {
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      canvas.width = innerWidth; canvas.height = innerHeight;
      const pieces = [];
      const colors = ['#00a650','#ffd700','#00d66f','#ffffff'];

      for(let i=0;i<200;i++){
        pieces.push({x:Math.random()*canvas.width, y:-20, size:Math.random()*10+5, speed:Math.random()*6+4, color:colors[Math.floor(Math.random()*colors.length)], rot:0, spin:Math.random()*10-5});
      }

      function anim(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        pieces.forEach(p=>{
          p.y += p.speed; p.rot += p.spin;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot*Math.PI/180);
          ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*3);
          ctx.restore();
        });
        requestAnimationFrame(anim);
      }
      anim();
      setTimeout(()=>{canvas.width=1;},5000);
    }

    updateAll();
  </script>
</body>
</html>